### ============================================
### ASSIST FLOW BACKEND - PRUEBAS API
### ============================================
### 
### Instrucciones:
### 1. Instala la extensión "REST Client" en VS Code
### 2. Asegúrate de que el servidor esté corriendo (start_server.bat)
### 3. Haz clic en "Send Request" sobre cada petición
### 4. Los tokens se guardan automáticamente entre requests
###
### Base URL
@baseUrl = http://localhost:3000/api/v1
@healthUrl = http://localhost:3000

### ============================================
### 1. HEALTH CHECK - Verificar que el servidor funciona
### ============================================

GET {{healthUrl}}/health
Content-Type: application/json

### ============================================
### 2. REGISTRO - Crear empresa + administrador
### ============================================

# @name registro
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "company_name": "Mi Empresa Demo",
  "email": "admin@miempresa.com",
  "password": "Admin123!",
  "full_name": "Administrador Principal"
}

### Guardar el token del admin (se ejecuta automáticamente)
@adminToken = {{registro.response.body.token}}

### ============================================
### 3. LOGIN ADMINISTRADOR
### ============================================

# @name loginAdmin
POST {{baseUrl}}/auth/admin_login
Content-Type: application/json

{
  "email": "admin@miempresa.com",
  "password": "Admin123!"
}

### Actualizar token con el del login
@adminToken = {{loginAdmin.response.body.token}}

### ============================================
### 4. OBTENER DATOS DE LA EMPRESA
### ============================================

# @name getCompany
GET {{baseUrl}}/companies/{{loginAdmin.response.body.user.company_id}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 5. CREAR EMPLEADO
### ============================================

# @name crearEmpleado
POST {{baseUrl}}/employees
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "Juan Pérez",
  "dni": "12345678",
  "phone": "999888777",
  "email": "juan@miempresa.com",
  "job_position": "Desarrollador",
  "salary": 3500
}

### Guardar el ID y PIN del empleado
@employeeId = {{crearEmpleado.response.body.employee.id}}
@employeePin = {{crearEmpleado.response.body.pin}}

### ============================================
### 6. LISTAR TODOS LOS EMPLEADOS
### ============================================

GET {{baseUrl}}/employees
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 7. VER DETALLES DE UN EMPLEADO
### ============================================

GET {{baseUrl}}/employees/{{employeeId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 8. CREAR UBICACIÓN DE EMPRESA (GEOFENCE)
### ============================================

# @name crearUbicacion
POST {{baseUrl}}/companies/{{loginAdmin.response.body.user.company_id}}/locations
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "Oficina Principal",
  "latitude": -12.046374,
  "longitude": -77.042793,
  "radius": 100
}

### ============================================
### 9. LOGIN DE EMPLEADO (con PIN y Password)
### ============================================

# @name loginEmpleado
POST {{baseUrl}}/auth/employee_login
Content-Type: application/json

{
  "company_id": "{{loginAdmin.response.body.user.company_id}}",
  "pin": "{{employeePin}}",
  "password": "Employee123!"
}

### Guardar token del empleado
@employeeToken = {{loginEmpleado.response.body.token}}

### ============================================
### 10. REGISTRAR ENTRADA (Check-in)
### ============================================

# @name registrarEntrada
POST {{baseUrl}}/attendance_records
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

{
  "attendance_type": "entrance",
  "latitude": -12.046374,
  "longitude": -77.042793
}

### ============================================
### 11. REGISTRAR SALIDA (Check-out)
### ============================================

POST {{baseUrl}}/attendance_records
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

{
  "attendance_type": "exit",
  "latitude": -12.046374,
  "longitude": -77.042793
}

### ============================================
### 12. VER REGISTROS DE ASISTENCIA DEL DÍA
### ============================================

GET {{baseUrl}}/attendance_records/today
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

### ============================================
### 13. VER HISTORIAL DE ASISTENCIAS
### ============================================

GET {{baseUrl}}/attendance_records
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

### ============================================
### 14. SOLICITAR VACACIONES (Como empleado)
### ============================================

# @name solicitarVacaciones
POST {{baseUrl}}/vacation_requests
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

{
  "start_date": "2025-12-01",
  "end_date": "2025-12-07",
  "reason": "Vacaciones de fin de año"
}

### ============================================
### 15. VER SOLICITUDES DE VACACIONES (Como admin)
### ============================================

GET {{baseUrl}}/vacation_requests
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 16. APROBAR SOLICITUD DE VACACIONES (Como admin)
### ============================================

POST {{baseUrl}}/vacation_requests/{{solicitarVacaciones.response.body.vacation_request.id}}/approve
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 17. VER NOTIFICACIONES (Como empleado)
### ============================================

GET {{baseUrl}}/notifications
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

### ============================================
### 18. MARCAR NOTIFICACIÓN COMO LEÍDA
### ============================================

# Primero obtén las notificaciones y usa el ID de una de ellas
PUT {{baseUrl}}/notifications/1
Authorization: Bearer {{employeeToken}}
Content-Type: application/json

{
  "is_read": true
}

### ============================================
### 19. DASHBOARD / REPORTES (Como admin)
### ============================================

GET {{baseUrl}}/reports/dashboard
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### 20. REPORTE DE ASISTENCIA POR PERÍODO
### ============================================

GET {{baseUrl}}/reports/attendance?start_date=2025-11-01&end_date=2025-11-30
Authorization: Bearer {{adminToken}}
Content-Type: application/json

### ============================================
### PRUEBAS ADICIONALES
### ============================================

### Actualizar datos del empleado
PUT {{baseUrl}}/employees/{{employeeId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "Juan Carlos Pérez",
  "job_position": "Senior Developer",
  "salary": 4000
}

### Crear más empleados
POST {{baseUrl}}/employees
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "María García",
  "dni": "87654321",
  "phone": "999777666",
  "email": "maria@miempresa.com",
  "job_position": "Diseñadora",
  "salary": 3200
}

### Rechazar solicitud de vacaciones
POST {{baseUrl}}/vacation_requests/{{solicitarVacaciones.response.body.vacation_request.id}}/reject
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "reason": "Personal insuficiente en esas fechas"
}

### ============================================
### NOTAS:
### - Ejecuta los requests EN ORDEN
### - Los tokens se guardan automáticamente
### - Si hay error 401, ejecuta el login de nuevo
### - Cambia las coordenadas según tu ubicación real
### ============================================
